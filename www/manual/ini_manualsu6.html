<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Programming a simple HTTP server</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.cse.ohio-state.edu/~gurari/TeX4ht/)"> 
<!-- html,frames,3,info --> 
<meta name="src" content="ini_manual.tex"> 
<meta name="date" content="2010-09-12 12:23:00"> 
<link rel="stylesheet" type="text/css" href="ini_manual.css"> 
</head><body 
>
   <!--l. 414--><div class="crosslinks"><p class="noindent">[<a 
href="ini_manualsu5.html" >prev</a>] [<a 
href="ini_manualsu5.html#tailini_manualsu5.html" >prev-tail</a>] [<a 
href="#tailini_manualsu6.html">tail</a>] [<a 
href="ini_manualse3.html#ini_manualsu6.html" >up</a>] </p></div>
   <h4 class="subsectionHead"><span class="titlemark">3.4   </span> <a 
 id="x13-100003.4"></a>Programming a simple HTTP server</h4>
<!--l. 416--><p class="noindent" >In order to illustrate the use of Java objets and the use of asynchronous
event-based rules, we will now study a slightly more complex example. The goal
of this example is to program a very simple HTTP server, which is not meant to
be complete, but to explain basic programming principles in INI. For this
example, we will use the <span 
class="cmtt-10x-x-109">java.net </span>API for sockets, and some of the <span 
class="cmtt-10x-x-109">java.io</span>
classes. To use Java objects from INI the programmer just need to define
bindings from INI functions to Java constructors, methods or fields. For instance,
to bind an <span 
class="cmtt-10x-x-109">out() </span>function to the <span 
class="cmtt-10x-x-109">System.out </span>Java writer, you need to define the
following binding:
   <!--l. 418-->
   <div class="lstlisting" id="listing-19"><span class="label"><a 
 id="x13-10001r1"></a></span>out()<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x003E;</span>Writer&#x00A0;=<span 
class="cmmi-10x-x-109">&#x003E;</span>&#x00A0;&#8221;java.lang.System&#8221;,&#x00A0;&#8221;out&#8221;
   
   </div>
<!--l. 422--><p class="indent" >   Note that this binding defines a new function <span 
class="cmtt-10x-x-109">out</span>, which is typed in INI with
the functional type <span 
class="cmtt-10x-x-109">()-&#x003E;Writer </span>as indicated in the binding definition. Since the
<span 
class="cmtt-10x-x-109">Writer </span>type does not exist in INI, INI will create a new type so that type
checking can be performed properly. You can now define a binding for the Java
writer&#8217;s <span 
class="cmtt-10x-x-109">println(String) </span>function. Note that since this function is not
static, in INI you must pass the instance as the first parameter of the
function:
   <!--l. 424-->
   <div class="lstlisting" id="listing-20"><span class="label"><a 
 id="x13-10002r1"></a></span>java_println(Writer,String)<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x003E;</span>Void&#x00A0;<br /><span class="label"><a 
 id="x13-10003r2"></a></span>&#x00A0;&#x00A0;=<span 
class="cmmi-10x-x-109">&#x003E;</span>&#x00A0;&#8221;java.io.Writer&#8221;,&#x00A0;&#8221;println(..)&#8221;
   
   </div>
<!--l. 429--><p class="indent" >   Note that we name the binding <span 
class="cmtt-10x-x-109">java</span><span 
class="cmtt-10x-x-109">_println </span>to avoid the name clash with
the <span 
class="cmtt-10x-x-109">println </span>built-in INI function. Also, note the <span 
class="cmtt-10x-x-109">"println(..)" </span>notation, which
means that INI will try to map to the function named <span 
class="cmtt-10x-x-109">println</span>, with the best
match in the parameter types. Once the bindings have been defined, the
programmer can use them from their INI functions. Bindings must always be
declared at the beginning of INI files. For instance:
   <!--l. 431-->
                                                                     

                                                                     
   <div class="lstlisting" id="listing-21"><span class="label"><a 
 id="x13-10004r1"></a><span 
class="cmr-9">1</span></span>out()<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x003E;</span>Writer&#x00A0;=<span 
class="cmmi-10x-x-109">&#x003E;</span>&#x00A0;&#8221;java.lang.System&#8221;,&#x00A0;&#8221;out&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10005r2"></a><span 
class="cmr-9">2</span></span>java_println(Writer,String)<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x003E;</span>Void&#x00A0;<br /><span class="label"><a 
 id="x13-10006r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;=<span 
class="cmmi-10x-x-109">&#x003E;</span>&#x00A0;&#8221;java.io.Writer&#8221;,&#x00A0;&#8221;println(..)&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10007r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10008r5"></a><span 
class="cmr-9">5</span></span>function&#x00A0;main()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10009r6"></a><span 
class="cmr-9">6</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10010r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;java_println(out(),&#8221;hello&#x00A0;Java&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10011r8"></a><span 
class="cmr-9">8</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10012r9"></a><span 
class="cmr-9">9</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 443--><p class="indent" >   Type safety within the INI program is ensured through the binding
declarations. It is the task of the programmers to define consistent bindings with
regards to the types. Finally, the bindings to Java class constructors are achieved
by using <span 
class="cmtt-10x-x-109">"new(..)" </span>for the method name.
<!--l. 445--><p class="indent" >   For programming our HTTP server, we will need to define a few bindings to
Java functions, which we give right away:
   <!--l. 447-->
   <div class="lstlisting" id="listing-22"><span class="label"><a 
 id="x13-10013r1"></a><span 
class="cmr-9">1</span></span><span 
class="cmr-10">socket</span><span 
class="cmr-10">_server</span><span 
class="cmr-10">(</span><span 
class="cmr-10">Int</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">ServerSocket</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10014r2"></a><span 
class="cmr-9">2</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">ServerSocket</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">new</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10015r3"></a><span 
class="cmr-9">3</span></span><span 
class="cmr-10">socket</span><span 
class="cmr-10">_accept</span><span 
class="cmr-10">(</span><span 
class="cmr-10">ServerSocket</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10016r4"></a><span 
class="cmr-9">4</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">ServerSocket</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">accept</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10017r5"></a><span 
class="cmr-9">5</span></span><span 
class="cmr-10">socket</span><span 
class="cmr-10">_address</span><span 
class="cmr-10">(</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">InetAddress</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10018r6"></a><span 
class="cmr-9">6</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">getInetAddress</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10019r7"></a><span 
class="cmr-9">7</span></span><span 
class="cmr-10">host</span><span 
class="cmr-10">_name</span><span 
class="cmr-10">(</span><span 
class="cmr-10">InetAddress</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">String</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10020r8"></a><span 
class="cmr-9">8</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">InetAddress</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">getHostName</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10021r9"></a><span 
class="cmr-9">9</span></span><span 
class="cmr-10">socket</span><span 
class="cmr-10">_input</span><span 
class="cmr-10">_stream</span><span 
class="cmr-10">(</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">InputStream</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10022r10"></a><span 
class="cmr-9">10</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">getInputStream</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10023r11"></a><span 
class="cmr-9">11</span></span><span 
class="cmr-10">socket</span><span 
class="cmr-10">_output</span><span 
class="cmr-10">_stream</span><span 
class="cmr-10">(</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">OutputStream</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10024r12"></a><span 
class="cmr-9">12</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">net</span><span 
class="cmr-10">.</span><span 
class="cmr-10">Socket</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">getOutputStream</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10025r13"></a><span 
class="cmr-9">13</span></span><span 
class="cmr-10">reader</span><span 
class="cmr-10">(</span><span 
class="cmr-10">InputStream</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">Reader</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10026r14"></a><span 
class="cmr-9">14</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">InputStreamReader</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">new</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10027r15"></a><span 
class="cmr-9">15</span></span><span 
class="cmr-10">buffered</span><span 
class="cmr-10">_reader</span><span 
class="cmr-10">(</span><span 
class="cmr-10">Reader</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">BufferedReader</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10028r16"></a><span 
class="cmr-9">16</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">BufferedReader</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">new</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10029r17"></a><span 
class="cmr-9">17</span></span><span 
class="cmr-10">data</span><span 
class="cmr-10">_output</span><span 
class="cmr-10">_stream</span><span 
class="cmr-10">(</span><span 
class="cmr-10">OutputStream</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">DataOutputStream</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10030r18"></a><span 
class="cmr-9">18</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">DataOutputStream</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">new</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10031r19"></a><span 
class="cmr-9">19</span></span><span 
class="cmr-10">read</span><span 
class="cmr-10">_line</span><span 
class="cmr-10">(</span><span 
class="cmr-10">BufferedReader</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">String</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10032r20"></a><span 
class="cmr-9">20</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">BufferedReader</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">readLine</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10033r21"></a><span 
class="cmr-9">21</span></span><span 
class="cmr-10">write</span><span 
class="cmr-10">_string</span><span 
class="cmr-10">(</span><span 
class="cmr-10">DataOutputStream</span><span 
class="cmr-10">,</span><span 
class="cmr-10">String</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">Void</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10034r22"></a><span 
class="cmr-9">22</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">DataOutputStream</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">writeBytes</span><span 
class="cmr-10">(..)&#8221;</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10035r23"></a><span 
class="cmr-9">23</span></span><span 
class="cmr-10">close</span><span 
class="cmr-10">(</span><span 
class="cmr-10">DataOutputStream</span><span 
class="cmr-10">)</span><span 
class="cmsy-10">-</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">Void</span><span 
class="cmr-10">&#x00A0;</span><br /><span class="label"><a 
 id="x13-10036r24"></a><span 
class="cmr-9">24</span></span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">=</span><span 
class="cmmi-10">&#x003E;</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">java</span><span 
class="cmr-10">.</span><span 
class="cmr-10">io</span><span 
class="cmr-10">.</span><span 
class="cmr-10">Closeable</span><span 
class="cmr-10">&#8221;,</span><span 
class="cmr-10">&#x00A0;</span><span 
class="cmr-10">&#8221;</span><span 
class="cmr-10">close</span><span 
class="cmr-10">(..)&#8221;</span>
   
   </div>
<!--l. 474--><p class="indent" >   Next, we implement a function <span 
class="cmtt-10x-x-109">start</span><span 
class="cmtt-10x-x-109">_http</span><span 
class="cmtt-10x-x-109">_server </span>that will use a server
socket to listen to some TCP client connections. For those who are not
familiar with the TCP socket API, the principles are the following: the
programmer must open a server socket and call the <span 
class="cmtt-10x-x-109">accept </span>function on
it in order to wait for some client connections. The call to <span 
class="cmtt-10x-x-109">accept </span>is
always blocking, meaning that the program will halt until a connection
happens. Once a new connection is made by a TCP client, the programs
starts again and the <span 
class="cmtt-10x-x-109">accept </span>function returns a new socket on which the
client/server communication can be done. Thus the server may continue to listen
to some other client connections on the initial server socket, assuming
that the program deals with the client requests in different threads or
processes.
   <!--l. 476-->
   <div class="lstlisting" id="listing-23"><span class="label"><a 
 id="x13-10037r1"></a><span 
class="cmr-9">1</span></span>function&#x00A0;start_http_server(port)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10038r2"></a><span 
class="cmr-9">2</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10039r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;socket_server(port)&#x00A0;<br /><span class="label"><a 
 id="x13-10040r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;Server&#x00A0;started&#x00A0;on&#x00A0;&#8221;+port)&#x00A0;<br /><span class="label"><a 
 id="x13-10041r5"></a><span 
class="cmr-9">5</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10042r6"></a><span 
class="cmr-9">6</span></span>&#x00A0;&#x00A0;s&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10043r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;//&#x00A0;wait&#x00A0;for&#x00A0;a&#x00A0;connection&#x00A0;<br /><span class="label"><a 
 id="x13-10044r8"></a><span 
class="cmr-9">8</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;c&#x00A0;=&#x00A0;socket_accept(s)&#x00A0;<br /><span class="label"><a 
 id="x13-10045r9"></a><span 
class="cmr-9">9</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;//&#x00A0;here&#x00A0;we&#x00A0;can&#x00A0;deal&#x00A0;with&#x00A0;the&#x00A0;connections&#x00A0;<br /><span class="label"><a 
 id="x13-10046r10"></a><span 
class="cmr-9">10</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;...&#x00A0;<br /><span class="label"><a 
 id="x13-10047r11"></a><span 
class="cmr-9">11</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10048r12"></a><span 
class="cmr-9">12</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 491--><p class="indent" >   In code above, the server socket is constructed line 3. You can note the use of
the <span 
class="cmtt-10x-x-109">s </span>guard on line 6. This guard allows the <span 
class="cmtt-10x-x-109">socket</span><span 
class="cmtt-10x-x-109">_accept </span>function to be called
under the condition that the server socket <span 
class="cmtt-10x-x-109">s </span>is actually constructed. Use of
such variable existence rules for programming is typical of rule-based
programing with INI and allows safer programming since it encourages
the programmer to define all the conditions under which actions can be
executed.
<!--l. 493--><p class="indent" >   It would be possible to deal with client connections after the <span 
class="cmtt-10x-x-109">socket</span><span 
class="cmtt-10x-x-109">_accept</span>
function call, as indicated at lines 9 and 10. However, several client connections
                                                                     

                                                                     
would not be able to be handled in parallel. Thus, with INI, the best way to deal
with the connections is to use an event-trigerred rule. Event-trigerred rules are
asynchronous and execute in different execution threads and straightforwardly
allows for multithreaded programs. Here, we can use the <span 
class="cmtt-10x-x-109">@update </span>event on the <span 
class="cmtt-10x-x-109">c</span>
variable, which will trigger the action when the variable is updated, as the event
name says.
   <!--l. 495-->
   <div class="lstlisting" id="listing-24"><span class="label"><a 
 id="x13-10049r1"></a><span 
class="cmr-9">1</span></span>function&#x00A0;start_http_server(port)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10050r2"></a><span 
class="cmr-9">2</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10051r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;socket_server(port)&#x00A0;<br /><span class="label"><a 
 id="x13-10052r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;clear(c)&#x00A0;<br /><span class="label"><a 
 id="x13-10053r5"></a><span 
class="cmr-9">5</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;Server&#x00A0;started&#x00A0;on&#x00A0;&#8221;+port)&#x00A0;<br /><span class="label"><a 
 id="x13-10054r6"></a><span 
class="cmr-9">6</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10055r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;s&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10056r8"></a><span 
class="cmr-9">8</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;c&#x00A0;=&#x00A0;socket_accept(s)&#x00A0;<br /><span class="label"><a 
 id="x13-10057r9"></a><span 
class="cmr-9">9</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10058r10"></a><span 
class="cmr-9">10</span></span>&#x00A0;&#x00A0;@update(c)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10059r11"></a><span 
class="cmr-9">11</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;//&#x00A0;deal&#x00A0;with&#x00A0;the&#x00A0;connections&#x00A0;(asynchronous)&#x00A0;<br /><span class="label"><a 
 id="x13-10060r12"></a><span 
class="cmr-9">12</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;...&#x00A0;<br /><span class="label"><a 
 id="x13-10061r13"></a><span 
class="cmr-9">13</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10062r14"></a><span 
class="cmr-9">14</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 512--><p class="indent" >   Note the <span 
class="cmtt-10x-x-109">clear(c) </span>statement added at line 4, which is necessary for the
<span 
class="cmtt-10x-x-109">@update </span>guard to be correctly installed on the <span 
class="cmtt-10x-x-109">c </span>variable. The <span 
class="cmtt-10x-x-109">clear </span>function is
a built-in function and allows for (re)-initialization of a variable content. It is
often used to make sure that the variable is defined when <span 
class="cmtt-10x-x-109">@update </span>event is
installed, i.e. right after the function&#8217;s initialization. In order to deal with the
client connections we use the input and output streams of the socket
produced by the <span 
class="cmtt-10x-x-109">socket</span><span 
class="cmtt-10x-x-109">_accept </span>function. For simplicity, we delegate to a
<span 
class="cmtt-10x-x-109">handle</span><span 
class="cmtt-10x-x-109">_http</span><span 
class="cmtt-10x-x-109">_request </span>function.
   <!--l. 514-->
   <div class="lstlisting" id="listing-25"><span class="label"><a 
 id="x13-10063r1"></a><span 
class="cmr-9">1</span></span>//&#x00A0;Java&#x00A0;bindings&#x00A0;<br /><span class="label"><a 
 id="x13-10064r2"></a><span 
class="cmr-9">2</span></span>socket_server(Int)<span 
class="cmsy-10x-x-109">-</span><span 
class="cmmi-10x-x-109">&#x003E;</span>ServerSocket&#x00A0;<br /><span class="label"><a 
 id="x13-10065r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;=<span 
class="cmmi-10x-x-109">&#x003E;</span>&#x00A0;&#8221;java.net.ServerSocket&#8221;,&#x00A0;&#8221;new(..)&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10066r4"></a><span 
class="cmr-9">4</span></span>...&#x00A0;<br /><span class="label"><a 
 id="x13-10067r5"></a><span 
class="cmr-9">5</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10068r6"></a><span 
class="cmr-9">6</span></span>function&#x00A0;main()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10069r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10070r8"></a><span 
class="cmr-9">8</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;start_http_server(8080)&#x00A0;<br /><span class="label"><a 
 id="x13-10071r9"></a><span 
class="cmr-9">9</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10072r10"></a><span 
class="cmr-9">10</span></span><span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10073r11"></a><span 
class="cmr-9">11</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10074r12"></a><span 
class="cmr-9">12</span></span>function&#x00A0;start_http_server(port)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10075r13"></a><span 
class="cmr-9">13</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10076r14"></a><span 
class="cmr-9">14</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;socket_server(port)&#x00A0;<br /><span class="label"><a 
 id="x13-10077r15"></a><span 
class="cmr-9">15</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;clear(c)&#x00A0;<br /><span class="label"><a 
 id="x13-10078r16"></a><span 
class="cmr-9">16</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;Server&#x00A0;started&#x00A0;on&#x00A0;&#8221;+port)&#x00A0;<br /><span class="label"><a 
 id="x13-10079r17"></a><span 
class="cmr-9">17</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10080r18"></a><span 
class="cmr-9">18</span></span>&#x00A0;&#x00A0;s&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10081r19"></a><span 
class="cmr-9">19</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;c&#x00A0;=&#x00A0;socket_accept(s)&#x00A0;<br /><span class="label"><a 
 id="x13-10082r20"></a><span 
class="cmr-9">20</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10083r21"></a><span 
class="cmr-9">21</span></span>&#x00A0;&#x00A0;@update(c)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10084r22"></a><span 
class="cmr-9">22</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;client&#x00A0;=&#x00A0;socket_address(c)&#x00A0;<br /><span class="label"><a 
 id="x13-10085r23"></a><span 
class="cmr-9">23</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(to_string(host_name(client))&#x00A0;<br /><span class="label"><a 
 id="x13-10086r24"></a><span 
class="cmr-9">24</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;+&#8221;&#x00A0;connected&#x00A0;to&#x00A0;server&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10087r25"></a><span 
class="cmr-9">25</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;in&#x00A0;=&#x00A0;buffered_reader(reader(&#x00A0;<br /><span class="label"><a 
 id="x13-10088r26"></a><span 
class="cmr-9">26</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;socket_input_stream(c)))&#x00A0;<br /><span class="label"><a 
 id="x13-10089r27"></a><span 
class="cmr-9">27</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;out&#x00A0;=&#x00A0;data_output_stream(socket_output_stream(c))&#x00A0;<br /><span class="label"><a 
 id="x13-10090r28"></a><span 
class="cmr-9">28</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;handle_http_request(in,&#x00A0;out)&#x00A0;<br /><span class="label"><a 
 id="x13-10091r29"></a><span 
class="cmr-9">29</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10092r30"></a><span 
class="cmr-9">30</span></span><span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10093r31"></a><span 
class="cmr-9">31</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10094r32"></a><span 
class="cmr-9">32</span></span>function&#x00A0;handle_http_request(in,&#x00A0;out)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10095r33"></a><span 
class="cmr-9">33</span></span>&#x00A0;&#x00A0;line!=&#8221;&#8221;&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10096r34"></a><span 
class="cmr-9">34</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;line&#x00A0;=&#x00A0;read_line(in)&#x00A0;<br /><span class="label"><a 
 id="x13-10097r35"></a><span 
class="cmr-9">35</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10098r36"></a><span 
class="cmr-9">36</span></span>&#x00A0;&#x00A0;line&#x00A0;&#x02DC;&#x00A0;regexp(&#8221;GET&#x00A0;(.<span 
class="cmsy-10x-x-109">*</span>)&#x00A0;(.<span 
class="cmsy-10x-x-109">*</span>)&#8221;,&#x00A0;path,&#x00A0;version)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10099r37"></a><span 
class="cmr-9">37</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;GET&#x00A0;FOUND:&#x00A0;&#8221;+path+&#8221;&#x00A0;<span 
class="cmsy-10x-x-109">-</span>&#x00A0;&#8221;+version)&#x00A0;<br /><span class="label"><a 
 id="x13-10100r38"></a><span 
class="cmr-9">38</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10101r39"></a><span 
class="cmr-9">39</span></span>&#x00A0;&#x00A0;@end()&#x00A0;path&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10102r40"></a><span 
class="cmr-9">40</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;//&#x00A0;generate&#x00A0;an&#x00A0;empty&#x00A0;response&#x00A0;<br /><span class="label"><a 
 id="x13-10103r41"></a><span 
class="cmr-9">41</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;HTTP/1.0&#x00A0;200&#x00A0;OK<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10104r42"></a><span 
class="cmr-9">42</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Connection:&#x00A0;close<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10105r43"></a><span 
class="cmr-9">43</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Server:&#x00A0;INI&#x00A0;v0<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10106r44"></a><span 
class="cmr-9">44</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Content<span 
class="cmsy-10x-x-109">-</span>Type:&#x00A0;text/html<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10107r45"></a><span 
class="cmr-9">45</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Content<span 
class="cmsy-10x-x-109">-</span>Length:&#x00A0;0<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10108r46"></a><span 
class="cmr-9">46</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;close(out)&#x00A0;<br /><span class="label"><a 
 id="x13-10109r47"></a><span 
class="cmr-9">47</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;end&#x00A0;of&#x00A0;request&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10110r48"></a><span 
class="cmr-9">48</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10111r49"></a><span 
class="cmr-9">49</span></span>&#x00A0;&#x00A0;@end()&#x00A0;!path&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10112r50"></a><span 
class="cmr-9">50</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;close(out)&#x00A0;<br /><span class="label"><a 
 id="x13-10113r51"></a><span 
class="cmr-9">51</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;illegal&#x00A0;request&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10114r52"></a><span 
class="cmr-9">52</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10115r53"></a><span 
class="cmr-9">53</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 570--><p class="indent" >   For dealing with HTTP requests, we use the match operator for strings,
which allows matching against regular expressions (at line 36). The regular
expression seeks for a <span 
class="cmtt-10x-x-109">GET </span>HTTP command. In the HTTP protocol syntax, the
<span 
class="cmtt-10x-x-109">GET </span>command is followed by the path and the HTTP version, which are
space-separated. In the regular expression <span class="cite">[<a 
href="ini_manualli2.html#Xfriedl2006">2</a>]</span> standard used by INI (see
[...]), parenthesis produce match outputs, which can be bound to INI
variables. Here, <span 
class="cmtt-10x-x-109">regexp("GET (.*) (.*)", path, version) </span>binds the two
space-separated expressions following the <span 
class="cmtt-10x-x-109">GET </span>command to the <span 
class="cmtt-10x-x-109">path </span>and
<span 
class="cmtt-10x-x-109">version </span>variables. This binding enables the <span 
class="cmtt-10x-x-109">@end() </span>event to trigger the
code that generates the HTTP response page, since the guard is only
true upon the <span 
class="cmtt-10x-x-109">path </span>condition at line 39. In the case the <span 
class="cmtt-10x-x-109">path </span>variable is
not bound, the function ends without responding to the request (line
50).
<!--l. 572--><p class="indent" >   Finally we can add a function to generate some HTML content. In INI, one
can reference functions and pass them as parameters to other functions (similarly
to closures in functional languages). Here, for instance, we can make the program
                                                                     

                                                                     
more generic by passing a function that will handle the requests. Thus, we
can add a <span 
class="cmtt-10x-x-109">handler </span>functional parameter to the <span 
class="cmtt-10x-x-109">start</span><span 
class="cmtt-10x-x-109">_http</span><span 
class="cmtt-10x-x-109">_server</span>
function.
   <!--l. 574-->
   <div class="lstlisting" id="listing-26"><span class="label"><a 
 id="x13-10116r1"></a><span 
class="cmr-9">1</span></span>[...]&#x00A0;<br /><span class="label"><a 
 id="x13-10117r2"></a><span 
class="cmr-9">2</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10118r3"></a><span 
class="cmr-9">3</span></span>function&#x00A0;start_http_server(port,handler)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10119r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;&#x00A0;@update(c)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10120r5"></a><span 
class="cmr-9">5</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;[...]&#x00A0;<br /><span class="label"><a 
 id="x13-10121r6"></a><span 
class="cmr-9">6</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;handle_http_request(in,&#x00A0;out,&#x00A0;handler)&#x00A0;<br /><span class="label"><a 
 id="x13-10122r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10123r8"></a><span 
class="cmr-9">8</span></span><span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10124r9"></a><span 
class="cmr-9">9</span></span>&#x00A0;<br /><span class="label"><a 
 id="x13-10125r10"></a><span 
class="cmr-9">10</span></span>function&#x00A0;handle_http_request(in,&#x00A0;out,&#x00A0;handler)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10126r11"></a><span 
class="cmr-9">11</span></span>&#x00A0;&#x00A0;[...]&#x00A0;<br /><span class="label"><a 
 id="x13-10127r12"></a><span 
class="cmr-9">12</span></span>&#x00A0;&#x00A0;@end()&#x00A0;path&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10128r13"></a><span 
class="cmr-9">13</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;body&#x00A0;=&#x00A0;eval(handler,path)&#x00A0;<br /><span class="label"><a 
 id="x13-10129r14"></a><span 
class="cmr-9">14</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;HTTP/1.0&#x00A0;200&#x00A0;OK<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10130r15"></a><span 
class="cmr-9">15</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Connection:&#x00A0;close<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10131r16"></a><span 
class="cmr-9">16</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Server:&#x00A0;INI&#x00A0;v0<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10132r17"></a><span 
class="cmr-9">17</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Content<span 
class="cmsy-10x-x-109">-</span>Type:&#x00A0;text/html<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10133r18"></a><span 
class="cmr-9">18</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;&#8221;Content<span 
class="cmsy-10x-x-109">-</span>Length:&#x00A0;&#8221;+&#x00A0;<br /><span class="label"><a 
 id="x13-10134r19"></a><span 
class="cmr-9">19</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;size(body)+&#8221;<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n<span 
class="cmsy-10x-x-109">\</span>r<span 
class="cmsy-10x-x-109">\</span>n&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10135r20"></a><span 
class="cmr-9">20</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;write_string(out,&#x00A0;body)&#x00A0;<br /><span class="label"><a 
 id="x13-10136r21"></a><span 
class="cmr-9">21</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;close(out)&#x00A0;<br /><span class="label"><a 
 id="x13-10137r22"></a><span 
class="cmr-9">22</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;println(&#8221;end&#x00A0;of&#x00A0;request&#8221;)&#x00A0;<br /><span class="label"><a 
 id="x13-10138r23"></a><span 
class="cmr-9">23</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10139r24"></a><span 
class="cmr-9">24</span></span>&#x00A0;&#x00A0;[...]&#x00A0;<br /><span class="label"><a 
 id="x13-10140r25"></a><span 
class="cmr-9">25</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 602--><p class="indent" >   The function referenced by the <span 
class="cmtt-10x-x-109">handler </span>variable is evaluated at line 13,
using the <span 
class="cmtt-10x-x-109">eval </span>built-in function. The <span 
class="cmtt-10x-x-109">eval </span>function takes a function
as a parameter and the parameter list to be passed to the evaluated
function. It returns the result of the evaluated function. In terms of typing,
the inferred type of <span 
class="cmtt-10x-x-109">eval </span>depends on the inferred type of the function
to be evaluated: <span 
class="cmtt-10x-x-109">eval(f:F,param</span><span 
class="cmtt-10x-x-109">_list)</span>:<span 
class="cmtt-10x-x-109">(F,T1,T2,...Tn)-&#x003E;T</span>, where
<span 
class="cmtt-10x-x-109">F=(T1,T2,...Tn)-&#x003E;T</span>. Here, we expect the <span 
class="cmtt-10x-x-109">handler </span>function to take a
string for the path of the requested URL and to return a string that
will be used as the body of the HTTP response. For instance, in the
following code, we can define a <span 
class="cmtt-10x-x-109">my</span><span 
class="cmtt-10x-x-109">_handler </span>function that generates a
&#8221;hello world&#8221; HTML page. Note the use of the <span 
class="cmtt-10x-x-109">@init() </span>and <span 
class="cmtt-10x-x-109">@end()</span>
rules, which can straightforwardly be used to wrap the response into
an HTML body. Also, rules can be used to generate different HTML
pages depending on the URL&#8217;s path. Here, <span 
class="cmtt-10x-x-109">my</span><span 
class="cmtt-10x-x-109">_handler </span>will return a
&#8221;hello world&#8221; content for the <span 
class="cmtt-10x-x-109">test </span>path (line 5), but an empty content for
other paths. Note also the use of the <span 
class="cmtt-10x-x-109">clear(path) </span>statement of line
7 to avoid the infinite application of the rule. One could also change
the path value (or other variable value) in the rule to trigger another
rule.
   <!--l. 604-->
   <div class="lstlisting" id="listing-27"><span class="label"><a 
 id="x13-10141r1"></a><span 
class="cmr-9">1</span></span>function&#x00A0;my_handler(path)&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10142r2"></a><span 
class="cmr-9">2</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10143r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;&#8221;<span 
class="cmmi-10x-x-109">&#x003C;</span>html<span 
class="cmmi-10x-x-109">&#x003E;&#x003C;</span>body<span 
class="cmmi-10x-x-109">&#x003E;</span>&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10144r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10145r5"></a><span 
class="cmr-9">5</span></span>&#x00A0;&#x00A0;path&#x00A0;==&#x00A0;&#8221;/test&#8221;&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10146r6"></a><span 
class="cmr-9">6</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;s&#x00A0;+&#x00A0;&#8221;hello&#x00A0;world&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10147r7"></a><span 
class="cmr-9">7</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;&#x00A0;clear(path)&#x00A0;<br /><span class="label"><a 
 id="x13-10148r8"></a><span 
class="cmr-9">8</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10149r9"></a><span 
class="cmr-9">9</span></span>&#x00A0;&#x00A0;@end()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10150r10"></a><span 
class="cmr-9">10</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;s&#x00A0;=&#x00A0;s&#x00A0;+&#x00A0;&#8221;<span 
class="cmmi-10x-x-109">&#x003C;</span>/body<span 
class="cmmi-10x-x-109">&#x003E;&#x003C;</span>/html<span 
class="cmmi-10x-x-109">&#x003E;</span>&#8221;&#x00A0;<br /><span class="label"><a 
 id="x13-10151r11"></a><span 
class="cmr-9">11</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;return&#x00A0;s&#x00A0;<br /><span class="label"><a 
 id="x13-10152r12"></a><span 
class="cmr-9">12</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10153r13"></a><span 
class="cmr-9">13</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
<!--l. 620--><p class="indent" >   Finally, this rule-based function looks similar to a controller in the MVC
architecture [...], except that the conditions that trigger the actions are clearly
specified in the code. Conditions may hold on the request state (path,
parameters, session variables), and possibly on the server state, even though is
would probably not be a nice idea to program a statefull HTTP server. To make
our server more complete, we should at least deal with the GET parameters and
the POST requests and parameters. For sake of simplicity, we will not enter in
such details here.
                                                                     

                                                                     
<!--l. 622--><p class="indent" >   Finally, we can start our HTTP server by passing the right handler function.
Note the use of the <span 
class="cmtt-10x-x-109">function </span>keyword at line 3 in the <span 
class="cmtt-10x-x-109">main </span>function, which
allows the program to get a function reference on the function named
<span 
class="cmtt-10x-x-109">my</span><span 
class="cmtt-10x-x-109">_handler</span>.
   <!--l. 624-->
   <div class="lstlisting" id="listing-28"><span class="label"><a 
 id="x13-10154r1"></a><span 
class="cmr-9">1</span></span>function&#x00A0;main()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10155r2"></a><span 
class="cmr-9">2</span></span>&#x00A0;&#x00A0;@init()&#x00A0;<span 
class="cmsy-10x-x-109">{</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10156r3"></a><span 
class="cmr-9">3</span></span>&#x00A0;&#x00A0;&#x00A0;&#x00A0;start_http_server(8080,&#x00A0;function(my_handler))&#x00A0;<br /><span class="label"><a 
 id="x13-10157r4"></a><span 
class="cmr-9">4</span></span>&#x00A0;&#x00A0;<span 
class="cmsy-10x-x-109">}</span>&#x00A0;<br /><span class="label"><a 
 id="x13-10158r5"></a><span 
class="cmr-9">5</span></span><span 
class="cmsy-10x-x-109">}</span>
   
   </div>
   <!--l. 632--><div class="crosslinks"><p class="noindent">[<a 
href="ini_manualsu5.html" >prev</a>] [<a 
href="ini_manualsu5.html#tailini_manualsu5.html" >prev-tail</a>] [<a 
href="ini_manualsu6.html" >front</a>] [<a 
href="ini_manualse3.html#ini_manualsu6.html" >up</a>] </p></div>
<!--l. 632--><p class="indent" >   <a 
 id="tailini_manualsu6.html"></a>  
</body></html> 
