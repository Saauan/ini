
/*
 * Warning: this example requires Jetty and the Servlet API in your classpath
 */

writer_println(PrintWriter,String)=>Void [class="java.io.PrintWriter", member="println(..)"]

process main() {
	@init() {
		start_web_service(8080, handle)
	}
	c:@consume(data) [channel="server"] {
		case data == "stop" {
			sleep(100)
			println("stopping web service")
			stop_web_service(8080)
			stop(c)
		}
	}
}

function handle(path, out) {
	@init() {
		println("action is invoked with "+path)		
	}
	
	path == "/test" {
		println("path = test")
		writer_println(out,"hello world wide web!")
		path = "/bye"
	}
	
	path == "/bye" {
		writer_println(out,"<p>bye!")
		clear(path)
		produce("server", "stop")
	}
	
}